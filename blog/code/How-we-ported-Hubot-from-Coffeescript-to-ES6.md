---
title: How we ported Hubot from Coffeescript to ES6
tags:
  - javascript
date: 2016-03-14 09:04:42
---

[![Hubo](https://farm1.staticflickr.com/91/210333714_cccff3a76f.jpg)](https://www.flickr.com/photos/franzbrandtwein/210333714/in/photolist-jA1Tm-7zsdd5-c3S9RY-6nV3Rp-96h4Vx-of3ttt-38gqh7-gmHXQv-dVEbJF-7E2T3H-HtFB3-robohy-druZRm-nrF4vh-HtFAN-7Dk3uW-pkMp7E-qpn51r-67WHcz-dmkogt-AkVdM-951oFH-af6bdQ-igcWis-bw1gLG-6ZkGsP-r3KjtA-aojgSy-qXYEst-ckHzAN-97rv7G-qfi5f6-bu6G96-4mdWDR-62fyWi-qgcVh4-89o3px-8AKiYq-Xb2wh-5K91Q3-rwerig-i19QiK-7jGYc7-2Pc3VK-bNBoUp-9RDmqK-9iEDUt-kb1z7K-dwYP4H-pN2djS "Hubo")<script async="" charset="utf-8" src="//embedr.flickr.com/assets/client-code.js"></script>

We (Fred Lin &amp; Ray Lin) have ported Github's popular chat robot framework '[Hubot'](https://github.com/github/hubot) from Coffeescript to plain Javascript with ES6 features. Currently I name it [**webbybot**](https://github.com/gasolin/webbybot) to denote ES6 version of hubot, to better test the port result and avoid the naming confusion with the original hubot.

Now webbybot is fully functional and still support all coffeescript written plugins.
If you have an existing bot generated by  hubot-generator, you can install webbybot via `npm  install webbybot` command, follow [with simple instruction](https://github.com/gasolin/webbybot#how-to-replace-hubot-to-webbybot) and see your bot works smoothly with webbybot core.

(For experienced developer, the instruction guide you to replace script in  generated '/bin' folder from 'hubot' to 'webby'. And change the adapter  library import from 'hubot' to 'webbybot'.)

As time goes to 2016, there're less reason to use [Coffeescript](http://coffeescript.org/) instead of standard ES6 Javascript. During the porting we do learned something that might helpful for your projects.

**1\. Use npm script directly instead of gulp or grunt**

With npm we can define some scripts directly in the 'script' attribution of 'package.json' file. Webbybot use 'npm run build' command to compile ES6 to plain javascript via [Babel](http://babeljs.io/). Do style checking via 'npm run lint' command.

**2\. Use babel directly instead of webpack**

At the beginning we count on [webpack](https://webpack.github.io/)'s babel-loader to convert ES6 to plain javascript. Alas its a beginning of 'Try and Error' journey. Webpack is originally designed for front-end packaging and works very well on that purpose. But for backend program like webbybot that feature is not important for us. Webpack also bring 'require' keyword to the front-end, but its not suit for backend program that depends on dynamic import. As a framework, hubot heavily counts on NODE require to load plugins. Webpack treat all 'require' as its keyword and try hard in vain to find external modules from packed files.

We tried several ways to detour these side effects, and finally replaced the full webpack stack with [one line npm build script](https://github.com/gasolin/webbybot/blob/master/package.json#L10). Now its easier to debug and no hacks needed in source code.

**3\. return or not return, its the question**

We use the  "Try Coffeescript" utility provide form [Coffeescript](http://coffeescript.org/) official site, which you can paste Coffeescript the page will convert the source to Javascript instantly.
The converted code is... not all pretty for human read, and all converted functions will contain a return statement even its unnecessary. It needs check by hand.

**4\. test cases matter**

Hubot itself contains good coverage of unit tests. So we are able to test one ported script file with one ported test file when we start the porting. The unit test files contain great number of redundant return sentences when convert from coffeescript.

**5\. class and super**

Hubot use Class syntax from Coffeescript。Thanksfully ES6 support the Class syntax, which is a bit different from Coffeescript. You can check how to use Class and super on [MDN.](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes) 

**6\. Default + rest + spread**

Hubot contain several syntax like 'reply(strings...)'. The syntax 'strings...' in Coffeescript is correspondent to "...strings" in ES6（The order of '...' is reversed）.
'...strings' denotes an array and I feel its a bit hard to figure out when to expand it or not.

**7\. for..of instead of for..in**

To use for..in loop in ES6, we need add 'hasOwnProperty' check to make sure inherited property are not looped. Or we can rewrite for..in loop in Coffeescript to forEach iteration. Though there are some cases that need 'break' or 'return' from a loop.

Now we use ES6 [for..of loop](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of) in Webbybot to replace forEach and for..in loop. You need wrap object with Object.keys syntax to iterate with object. ex: `for (let item  of Object.keys(TargetObj)) {...}`.

**8\. Object.assign instead of Extend**

We can use [Object.assign](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign) to extend a object without handmade extend function or lodash!

**9\. Do you know hubot also [support write plugin with plain javascript](https://github.com/gasolin/webbybot/blob/master/src/robot.js#L404)?**

Learning how chat bot works is the main reason we start porting hubot to ES6!
A simple plain javascript plugin could be as easy as: (src/simple.js)

```
> module.exports = function(robot) {
> &nbsp; robot.respond(/(hello)/i, function(res) {
> &nbsp; &nbsp; res.send('hi'); 
> &nbsp; });
> }You can put it in generated plugin folder and it will just work.
```

I've created a [ticket on hubot issue list](https://github.com/github/hubot/issues/1138) to start a discussion if hubot would like to go with ES6 in its future version.

The webbybot source is at[ https://github.com/gasolin/webbybot](https://github.com/gasolin/webbybot)

Do you have a project ported from coffeescript to ES6? Welcome to drop by your thoughts.
